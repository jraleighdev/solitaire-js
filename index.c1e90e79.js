let t;var i;let e;var s;let r;var h;function a(t,i,e){return(i=function(t){var i=function(t,i){if("object"!=typeof t||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var s=e.call(t,i||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(i))in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}(i=t||(t={}))[i.heart=0]="heart",i[i.club=1]="club",i[i.spade=2]="spade",i[i.diamond=3]="diamond",(s=e||(e={}))[s.ace=1]="ace",s[s.two=2]="two",s[s.three=3]="three",s[s.four=4]="four",s[s.five=5]="five",s[s.six=6]="six",s[s.seven=7]="seven",s[s.eight=8]="eight",s[s.nine=9]="nine",s[s.ten=10]="ten",s[s.jack=11]="jack",s[s.queen=12]="queen",s[s.king=13]="king",(h=r||(r={}))[h.red=0]="red",h[h.black=1]="black";class o{get bottomLeftPoint(){return{x:this.x,y:this.y+this.height}}get topLeftPoint(){return{x:this.x,y:this.y}}get topRightPoint(){return{x:this.x+this.width,y:this.y}}get bottomRightPoint(){return{x:this.x+this.width,y:this.y+this.height}}get topCenterPoint(){return{x:this.x+this.width/2,y:this.y}}get centerPoint(){return{x:this.x+this.width/2,y:this.y+this.height/2}}constructor(t,i,e,s){a(this,"x",void 0),a(this,"y",void 0),a(this,"height",void 0),a(this,"width",void 0),this.x=t,this.y=i,this.height=e,this.width=s}visualizePoints(t){this.arc(t,this.bottomLeftPoint),this.arc(t,this.bottomRightPoint),this.arc(t,this.topRightPoint),this.arc(t,this.topLeftPoint),this.arc(t,this.topCenterPoint)}arc(t,i){t.strokeStyle="green",t.beginPath(),t.arc(i.x,i.y,2,0,2*Math.PI),t.stroke()}}function n(t,i,e){return(i=function(t){var i=function(t,i){if("object"!=typeof t||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var s=e.call(t,i||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(i))in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}class c extends o{get Id(){return`${this.suite}-${this.cardNumber}`}get getOverlapPoint(){return{x:this.topLeftPoint.x,y:this.topLeftPoint.y+c.Offset}}constructor(i,s,h,a,o,d){switch(super(h,a,c.Height,c.Width),n(this,"parent",void 0),n(this,"path",void 0),n(this,"suite",void 0),n(this,"cardNumber",void 0),n(this,"cardColor",void 0),n(this,"showFace",!1),n(this,"isDragging",!1),n(this,"faceImage",void 0),n(this,"backImage",void 0),n(this,"ctx",void 0),n(this,"mousePoint",{x:0,y:0}),n(this,"offset",{x:0,y:0}),n(this,"previous",{x:0,y:0}),n(this,"cardMap",{[e.ace]:"A",[e.two]:"2",[e.three]:"3",[e.four]:"4",[e.five]:"5",[e.six]:"6",[e.seven]:"7",[e.eight]:"8",[e.nine]:"9",[e.ten]:"10",[e.jack]:"J",[e.queen]:"Q",[e.king]:"K"}),this.path=new Path2D,this.path.rect(h,a,this.width,this.height),this.suite=i,this.cardNumber=s,this.ctx=o,this.parent=d,this.suite){case t.club:this.faceImage=document.getElementById("club"),this.cardColor=r.black;break;case t.spade:this.faceImage=document.getElementById("spade"),this.cardColor=r.black;break;case t.heart:this.faceImage=document.getElementById("heart"),this.cardColor=r.red;break;case t.diamond:this.faceImage=document.getElementById("diamond"),this.cardColor=r.red}this.backImage=document.getElementById("cardBack")}draw(t=!1){this.path=new Path2D,this.path.rect(this.x,this.y,this.width,t?c.Offset:this.height),this.showFace?this.drawFace():this.drawBack()}drawFace(){const t=c.Width/2,i=c.Height/2.5;this.ctx.save(),this.ctx.fillStyle="white",this.ctx.fillRect(this.x,this.y,this.width,this.height),this.ctx.strokeStyle="#312f2f",this.ctx.strokeRect(this.x,this.y,this.width,this.height),this.ctx.drawImage(this.faceImage,this.x+t/2,this.y+i/2,this.width-t,this.height-i),this.ctx.fillStyle=this.cardColor==r.red?"red":"black",this.ctx.font="30px times new roman";const s=this.cardNumber==e.ten?10:0;this.ctx.fillText(this.cardMap[this.cardNumber],this.topLeftPoint.x+(10-s/2),this.topLeftPoint.y+30),this.ctx.fillText(this.cardMap[this.cardNumber],this.bottomRightPoint.x-(30+s),this.bottomRightPoint.y-10),this.ctx.restore()}drawBack(){const t=c.Width/3;this.ctx.save(),this.ctx.fillStyle="#194383",this.ctx.fillRect(this.x,this.y,this.width,this.height),this.ctx.strokeStyle="white",this.ctx.strokeRect(this.x,this.y,this.width,this.height),this.ctx.drawImage(this.backImage,this.x+t/2,this.y+t/2,this.width-t,this.height-t),this.ctx.restore()}getMouseOffset(){return this.offset}mouseDown(t){this.mousePoint=t,this.offset={x:Math.abs(this.mousePoint.x-this.x),y:Math.abs(this.mousePoint.y-this.y)}}mouseUp(){this.mousePoint={x:0,y:0}}getPrevious(){return this.previous}setPrevious(){this.previous={x:this.x,y:this.y}}restorePrevious(){this.x=this.previous.x,this.y=this.previous.y}move(t,i){this.x=t,this.y=i}}function d(t,i,e){return(i=function(t){var i=function(t,i){if("object"!=typeof t||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var s=e.call(t,i||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(i))in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}n(c,"Width",100),n(c,"Height",200),n(c,"Offset",30);class u extends o{constructor(t,i,e){super(t,i,c.Height,c.Width),this.ctx=e,d(this,"cards",[]),d(this,"deckPath",void 0),d(this,"nextCardPath",void 0),d(this,"nextCardStartPoint",void 0),d(this,"displayCard",void 0),this.nextCardStartPoint={x:this.x+c.Width+m.Margin,y:this.y},this.rebuildDeck(),this.deckPath=new Path2D,this.deckPath.rect(t,i,c.Width,c.Height),this.nextCardPath=new Path2D,this.nextCardPath.rect(this.nextCardStartPoint.x,this.nextCardStartPoint.y,c.Width,c.Height)}rebuildDeck(){this.cards=[];const i=[];for(let e=1;e<=52;e++){let s,r=t.club;e<=13?(s=e,r=t.club):e>13&&e<=26?(s=e-13,r=t.diamond):e>26&&e<=39?(s=e-26,r=t.heart):e>39&&e<=52&&(s=e-39,r=t.spade),i.push(new c(r,s,this.x,this.y,this.ctx,this))}let e,s=i.length;for(;0!=s;)e=Math.floor(Math.random()*s),s--,[i[s],i[e]]=[i[e],i[s]];this.cards.push(...i)}draw(){0==this.cards.length?(this.ctx.strokeStyle="white",this.ctx.strokeRect(this.x,this.y,c.Width,c.Height)):(this.cards[0].draw(),this.displayCard?.draw())}nextCard(){if(0!==this.cards.length){for(let t=0;t<=this.cards.length-1;t++){const i=this.cards[t];i.move(this.x,this.y),i.showFace=!1}this.displayCard&&(this.displayCard.move(this.x,this.y),this.displayCard.showFace=!1,this.cards.unshift(this.displayCard)),this.displayCard=this.remove(),this.displayCard&&(this.displayCard.move(this.nextCardStartPoint.x,this.nextCardStartPoint.y),this.displayCard.showFace=!0,this.displayCard.draw())}}getCardsAbove(t){return[t]}getCardsBelow(t){return[t]}add(t){this.cards.push(t)}remove(){if(0===this.cards.length)return;const t=this.cards[this.cards.length-1];return this.cards.pop(),t}}function l(t,i,e){return(i=function(t){var i=function(t,i){if("object"!=typeof t||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var s=e.call(t,i||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(i))in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}class f extends o{constructor(t,i,e,s,r=!0){super(t,i,c.Height,c.Width),l(this,"allowAnyType",void 0),l(this,"suite",void 0),l(this,"cards",[]),l(this,"path",void 0),l(this,"ctx",void 0),this.suite=s,this.ctx=e,this.allowAnyType=r,this.path=new Path2D,this.path.rect(this.x,this.y,this.width,this.height)}draw(){this.cards.length>0?this.allowAnyType?this.drawStackedCard():this.drawSingleCard():this.drawOutLine()}add(t){const i=this.x,e=0!==this.cards.length&&this.allowAnyType?this.y+c.Offset*this.cards.length:this.y;t.move(i,e),t.parent=this,this.cards.push(t)}remove(){if(0===this.cards.length)return;const t=this.cards[this.cards.length-1];return this.cards.pop(),this.flipCardBeneath(),t}flipCardBeneath(){if(0===this.cards.length)return;const t=this.cards[this.cards.length-1];t.showFace||(t.showFace=!0)}canCardBePlacedFinal(t){if(0===this.cards.length&&t.cardNumber===e.ace)return this.suite=t.suite,!0;if(this.cards.length){if(t.suite!==this.suite)return!1;if(t.cardNumber===this.cards[this.cards.length-1].cardNumber+1)return!0}return!1}canCardBePlacedPlaying(t){if(0===this.cards.length&&t.cardNumber===e.king)return!0;if(this.cards.length){const i=this.cards[this.cards.length-1];if(i.cardColor===t.cardColor)return!1;if(i.cardNumber-1===t.cardNumber)return!0}return!1}getCardsBelow(t){const i=[],e=this.cards.indexOf(t);if(e<this.cards.length-1)for(let t=e;t<=this.cards.length-1;t++)this.cards[t].setPrevious(),i.push(this.cards[t]);return i}getCardsAbove(t){return[t]}drawSingleCard(){this.cards[this.cards.length-1].draw()}drawStackedCard(){for(let t=0;t<=this.cards.length-1;t++){this.cards[t].draw(t<this.cards.length-1)}}drawOutLine(){this.ctx.save(),this.ctx.strokeStyle="white",this.ctx.strokeRect(this.x,this.y,c.Width,c.Height),this.ctx.restore()}}function g(t,i,e){return(i=function(t){var i=function(t,i){if("object"!=typeof t||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var s=e.call(t,i||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(i))in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}class v extends o{constructor(t,i,e,s,r,h,a,o){super(i,e,s,r),this.ctx=h,g(this,"hoverColor","#203657"),g(this,"path",void 0),g(this,"color",void 0),g(this,"action",void 0),g(this,"currentColor",void 0),g(this,"image",void 0),g(this,"imageOffset",2),this.color=t,this.currentColor=t,this.path=new Path2D,this.path.rect(i,e,r,s),this.action=a,this.image=o}draw(){this.ctx.save(),this.ctx.fillStyle=this.currentColor,this.ctx.fill(this.path),this.ctx.strokeStyle="white",this.ctx.stroke(this.path),this.ctx.drawImage(this.image,this.x+this.imageOffset,this.y+this.imageOffset,this.width-2*this.imageOffset,this.height-2*this.imageOffset),this.ctx.restore()}click(){this.action()}hover(){this.currentColor=this.hoverColor}hoverLeave(){this.currentColor=this.color}}function p(t,i,e){return(i=function(t){var i=function(t,i){if("object"!=typeof t||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var s=e.call(t,i||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(i))in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}class y{get Score(){return this._score}set Score(t){this._score=t}constructor(t,i){this.ctx=t,p(this,"restartImage",document.getElementById("restart")),p(this,"restartButton",void 0),p(this,"_score",0),this.restartButton=new v(y.ButtonColor,20,y.Height/2-y.ButtonHeight/2,y.ButtonWidth,y.ButtonHeight,this.ctx,i,this.restartImage),this.addEventListener()}draw(){this.drawBackGround(),this.drawScore(),this.restartButton.draw()}add(t){this._score+=t}reset(){this._score=0}drawScore(){this.ctx.save(),this.ctx.fillStyle="white",this.ctx.font="30px Arial",this.ctx.fillText(`Score: ${this.Score.toString()}`,m.Width/2,y.Height/2+y.FontSize/2),this.ctx.restore()}drawBackGround(){this.ctx.save(),this.ctx.fillStyle=y.Color,this.ctx.fillRect(0,0,m.Width,y.Height),this.ctx.restore()}addEventListener(){this.ctx.canvas.addEventListener("mousemove",(t=>{this.ctx.isPointInPath(this.restartButton.path,t.offsetX,t.offsetY)?this.restartButton.hover():this.restartButton.hoverLeave()})),this.ctx.canvas.addEventListener("click",(t=>{this.ctx.isPointInPath(this.restartButton.path,t.offsetX,t.offsetY)&&this.restartButton.click()}))}}function x(t,i,e){return(i=function(t){var i=function(t,i){if("object"!=typeof t||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var s=e.call(t,i||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(i))in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}p(y,"Height",60),p(y,"Color","#35792c"),p(y,"FontColor","white"),p(y,"Font","30px Arial"),p(y,"FontSize",20),p(y,"ButtonWidth",40),p(y,"ButtonHeight",40),p(y,"ButtonColor","#254620"),p(y,"tableueScore",5),p(y,"foundationScore",10);class m{constructor(t){this.ctx=t,x(this,"scoreBar",void 0),x(this,"stock",void 0),x(this,"tableauGroups",[]),x(this,"foundationGroup",[]),x(this,"moveableCards",[]),x(this,"dragGroup",[]),x(this,"deckLocation",{x:m.Margin,y:y.Height+m.Margin}),x(this,"restart",(()=>{this.tableauGroups=[],this.foundationGroup=[],this.buildGroups(),this.stock.rebuildDeck(),this.scoreBar.reset(),this.initializeCards(),this.draw()})),x(this,"previousPoint",{x:0,y:0}),this.scoreBar=new y(t,this.restart),this.stock=new u(this.deckLocation.x,this.deckLocation.y,t),this.buildGroups(),this.initializeCards(),this.addEventListener()}initializeCards(){let t=7;for(let i=this.tableauGroups.length-1;i>=0;i--){const e=this.tableauGroups[i];for(let i=1;i<=t;i++){const t=this.stock.remove();e.add(t)}e.cards[e.cards.length-1].showFace=!0,t--}this.checkMovableCards()}checkMovableCards(){this.moveableCards.splice(0),this.tableauGroups.forEach((t=>{t.cards.length>0&&this.moveableCards.push(...t.cards.filter((t=>t.showFace)))})),this.stock.cards.length>0&&this.stock.displayCard&&this.moveableCards.push(this.stock.displayCard)}draw(){this.ctx.fillStyle="#66c05a",this.ctx.fillRect(0,0,m.Width,m.Height),this.scoreBar.draw(),this.stock.draw(),this.tableauGroups.forEach((t=>t.draw())),this.foundationGroup.forEach((t=>t.draw())),this.checkMovableCards()}buildGroups(){for(let i=1;i<=7;i++){const e=1===i?this.deckLocation.x:this.deckLocation.x+(c.Width+m.Margin)*(i-1);this.tableauGroups.push(new f(e,this.deckLocation.y+m.Margin+c.Height,this.ctx,t.club,!0))}const i=this.tableauGroups[3].x;for(let t=1;t<=4;t++){const e=1===t?i:i+(c.Width+m.Margin)*(t-1);this.foundationGroup.push(new f(e,this.deckLocation.y,this.ctx,t-1,!1))}m.Width=m.Margin+this.tableauGroups[this.tableauGroups.length-1].bottomRightPoint.x,this.ctx.canvas.width=m.Width,this.ctx.canvas.height=m.Height}addEventListener(){this.ctx.canvas.addEventListener("mousedown",(t=>{t.preventDefault(),t.stopPropagation(),this.moveableCards.forEach((i=>{this.ctx.isPointInPath(i.path,t.offsetX,t.offsetY)&&(this.previousPoint={x:t.x,y:t.y},i.mouseDown({x:t.x,y:t.y}),i.setPrevious(),i.isDragging=!0,this.dragGroup=i.parent.getCardsBelow(i),this.draw())}))})),this.ctx.canvas.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),this.ctx.isPointInPath(this.stock.deckPath,t.offsetX,t.offsetY)&&(this.stock.nextCard(),this.checkMovableCards())})),this.ctx.canvas.addEventListener("mousemove",(t=>{t.preventDefault(),t.stopPropagation();const i=this.moveableCards.find((t=>t.isDragging));if(i&&(i.x=t.x-i.getMouseOffset().x,i.y=t.y-i.getMouseOffset().y,this.draw(),i.draw(),this.dragGroup.length>1))for(let t=1;t<=this.dragGroup.length-1;t++){const e=this.dragGroup[t];e.move(i.x,i.getOverlapPoint.y),e.draw()}})),this.ctx.canvas.addEventListener("mouseup",(t=>{t.preventDefault(),t.stopPropagation();const i=this.moveableCards.find((t=>t.isDragging));if(i){let e=!0;this.foundationGroup.forEach((s=>{this.ctx.isPointInPath(s.path,t.offsetX,t.offsetY)&&s.canCardBePlacedFinal(i)&&(i.parent.remove(),s.add(i),i.x=s.x,i.y=s.y,e=!1,i.Id==this.stock.displayCard?.Id&&(this.stock.displayCard=void 0),this.scoreBar.add(y.foundationScore))})),this.tableauGroups.forEach((s=>{const r=0===s.cards.length?s.path:s.cards[s.cards.length-1].path;if(this.ctx.isPointInPath(r,t.offsetX,t.offsetY)&&s.canCardBePlacedPlaying(i)){if(i.parent.remove(),s.add(i),i.Id===this.stock.displayCard?.Id&&this.scoreBar.add(y.tableueScore),this.dragGroup.length>1)for(let t=1;t<=this.dragGroup.length-1;t++){const i=this.dragGroup[t];i.parent.remove(),s.add(i)}e=!1,i.Id==this.stock.displayCard?.Id&&(this.stock.displayCard=void 0)}})),e&&(i.restorePrevious(),this.dragGroup.forEach((t=>t.restorePrevious()))),i.mouseUp(),i.isDragging=!1}this.draw(),this.moveableCards.forEach((t=>t.isDragging=!1)),this.dragGroup=[]}))}}x(m,"Height",1e3),x(m,"Width",1400),x(m,"Margin",40);const b=document.getElementById("canvas").getContext("2d");new m(b).draw();